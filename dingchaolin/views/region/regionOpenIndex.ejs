<%include ../navigation%>
<div class="ch-container">
	<% include ../sidebar%>
        <div id="content" class="col-lg-10 col-sm-10">
        	<div>
		        <ul class="breadcrumb">
		            <li><a href="/">主页</a></li>
		            <li><a href="/region/regionOpenList">大区状态</a></li>
		        </ul>
		    </div>
    	<div class="row">
		    <div class="box col-md-12">
		    <div class="box-inner">
		    <div class="box-header well">
		        <h2><i class="glyphicon glyphicon-user"> 大区状态</i></h2>
		    </div>
		    <div class="box-content">
		    	<table id="roomlist" class="table table-striped table-bordered table-hover bootstrap-datatable responsive">
				    <thead>
					    <tr>
					        <th>大区名称</th>
					        <th>佣金入口状态</th>
							<th>房间类型</th>
					        <th>操作</th>
					    </tr>
				    </thead>
		    		<tbody >
		    			<% if (regions || regions!=undefined || regions!='') {%>
			    			<% for(var i=0; i<regions.length; i++) {%>
							    <tr c-id="<%= regions[i].c_id %>">
							        <td class="col-md-1 regionname"><%= regions[i].c_name || '大区名称丢失' %></td>
							        <td class="col-md-2 regionstatus1">
							        	<% if (regions[i].yj_status == 0) { %>
							        		<span class="regionstatus1">未开通</span>
							        	<% } else if (regions[i].yj_status == 1) { %>
							        		<span class="regionstatus1">已开通</span>
							        	<% } else { %>
							        		状态丢失
							        	<% } %>
							        	<span class="regionstatus2" style="display:none;">
							        		<select class="form-control">
							        			<option value="1" selected="selected">开通</option>
							        			<option value="0">未开通</option>
							        		</select>
							        	</span>
							        </td>

									<td class="col-md-2 roomtype">
										<% if (regions[i].roomType == 1) { %>
										<span class="roomtype">营销周期排行大区</span>
										<% } else if (regions[i].roomType == 2) { %>
										<span class="roomtype">资源周期排行大区</span>
										<% } else { %>
										状态丢失
										<% } %>
										<span class="roomtype2" style="display:none;">
							        		<select class="form-control">
												<option value="1" selected="selected">营销周期排行大区</option>
												<option value="2">资源周期排行大区</option>
											</select>
							        	</span>
									</td>
							        <td class="col-md-2" style="position:relative;">
							        	<button class="btn btn-info edit">
							                <i class="glyphicon glyphicon-edit icon-white"></i> 编辑
							            </button>
							            <button class="btn btn-success save" style="display:none;">
							                <i class="glyphicon glyphicon-edit icon-white"></i> 保存
							            </button>
							        </td>
							    </tr>
							<% } %>
						<% } %>
	    			</tbody>
	    		</table>
	    	</div>
	    	<div id="barcon" name="barcon" align="right" style="width:97%"/>
	    </div>
    <!--/span-->
	</div>
</div>

<script type="text/javascript">
	$(".edit").click(function() {
		$(this).siblings('.save').css('display','inline-block');
		$(this).css('display', 'none');
		var regionname=$(this).parents('td').siblings('.regionname');
		var regionrank=$(this).parents('td').siblings('.regionrank');
		var roomtype=$(this).parents('td').siblings('.roomtype');
		var regionstatus1=$(this).parents('td').siblings('.regionstatus1');
		//td-->regionrank
		regionname.attr('contenteditable', 'true');
		regionname.css('background-color', '#9DE3EC');
		regionname.css('-webkit-box-shadow', '#666 0px 0px 10px');
		//td-->regionrank
		regionrank.attr('contenteditable', 'true');
		regionrank.css('background-color', '#9DE3EC');
		regionrank.css('-webkit-box-shadow', '#666 0px 0px 10px');
		//td-->regionstatus1
		regionstatus1.css('background-color', '#9DE3EC');
		regionstatus1.css('-webkit-box-shadow', '#666 0px 0px 10px');
		regionstatus1.find('.regionstatus1').css('display', 'none');
		regionstatus1.find('.regionstatus2').css('display', 'inline-block');
		regionstatus1.find('.roomtype1').css('display', 'none');
		regionstatus1.find('.roomtype2').css('display', 'inline-block');
		//td-->roomtype
		roomtype.css('background-color', '#9DE3EC');
		roomtype.css('-webkit-box-shadow', '#666 0px 0px 10px');
		roomtype.find('.regionstatus1').css('display', 'none');
		roomtype.find('.regionstatus2').css('display', 'inline-block');
		roomtype.find('.roomtype').css('display', 'none');
		roomtype.find('.roomtype2').css('display', 'inline-block');
		return false;
	});
	$(".save").click(function () {
		$(this).siblings('.edit').css('display','inline-block');
		$(this).css('display', 'none');
		var regionname=$(this).parents('td').siblings('.regionname');
		var roomtype=$(this).parents('td').siblings('.roomtype');
		var regionrank=$(this).parents('td').siblings('.regionrank');
		var regionstatus1=$(this).parents('td').siblings('.regionstatus1');
		//td-->regionname
		regionname.attr('contenteditable', null);
		regionname.removeAttr('style');
		//td-->regionstatus1
		regionstatus1.removeAttr('style');
		regionstatus1.find('.regionstatus1').css('display', 'inline-block');
		regionstatus1.find('.regionstatus2').css('display', 'none');
		//td-->roomtype
		roomtype.removeAttr('style');
		roomtype.find('.roomtype').css('display', 'inline-block');
		roomtype.find('.roomtype2').css('display', 'none');
		//td-->regionrank
		regionrank.attr('contenteditable', null);
		regionrank.removeAttr('style');

		var data={};
		data.c_id=$(this).parents('tr').attr('c-id');
		data.regionname=regionname.text();
		data.yj_status=regionstatus1.find('.regionstatus2 .form-control').val();
		data.roomtype = roomtype.find('.roomtype2 .form-control').val();
	  	$.post("/region/regionOpenYongJin", data, function(result){
	  		if (result=='ok') {
				if (regionstatus1.find('.regionstatus2 .form-control').val()==1){
					regionstatus1.find('.regionstatus1').html('已开通');
				} else {
					regionstatus1.find('.regionstatus1').html('未开通');
				}
				if (roomtype.find('.regionstatus2 .form-control').val() ==1){
					roomtype.find('.roomtype').html('营销周期排行大区');
				} else {
					roomtype.find('.roomtype2').html('资源周期排行大区');
				}
				window.location.reload();
				alert('更新数据成功');
	  			return true;
	  		}
	    	alert('更新数据失败请查看大区下是否存在房间！');
	    	return false;
	  	});
	});
</script>